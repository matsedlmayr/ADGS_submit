# Spatial Upscaling of Leaf Nitrogen Content

This project implements a spatial upscaling workflow to model global leaf nitrogen (Leaf N) content using environmental and geographic predictors. The work follows Ludwig et al. (2023) and leverages the publicly available leaf N dataset by Tian et al. (2019), curated by Stocker et al.

## Project Structure

- `vignettes/`  
  Contains the R Markdown report rm2.rmd that interpret the analysis. All results and figures here are generated from the scripts in `analysis/`, so the vignettes rely on precomputed data rather than re-running the models.
  
- `analysis/`  
  Contains R scripts that perform the main analysis:
  - `01_loaddata.R`: Downloads and prepares the dataset, selects the most common species, and performs initial data wrangling.
  - `02_runcv_model.R`: Implements random, spatial, and environmental cross-validation using Random Forest models, computes performance metrics (R², RMSE) for each fold.
  - `03_comparison1.R`: Generates comparison tables and figures summarizing CV performance and cluster distributions.

- `data/`  
  Stores processed datasets and results generated by the analysis scripts.

- `fig/`  
  Contains figures generated by the analysis, including spatial distributions, cluster plots, and CV performance comparisons.

- `book/`  
  ignore

- `data-raw/`  
  ignore

- `renv/` and `renv.lock`  
  ignore
  
- `r_book_template.Rproj`  
  ignore

- `LICENSE`  
  License file for the project.

## Workflow

1. **Data preparation**  
   Run `analysis/01_loaddata.R` to download, clean, and select the dataset.  

2. **Modeling & Cross-validation**  
   Run `analysis/02_runcv_model.R` to train Random Forest models using random, spatial, and environmental CV. Outputs include metrics, figures and intermediate data files.

3. **Comparison**  
   Run `analysis/03_comparison1.R` to generate figures and tables comparing model performance across CV strategies. These outputs are used in the vignettes for interpretation.

## References

- Ludwig, M. et al., 2023. Assessing and improving the transferability of current global spatial prediction models. *Global Ecology and Biogeography*, 32, 356–368.  
- Stocker, B., 2023. Spatial Upscaling. GECO, University of Bern. [Online](https://geco-bern.github.io/spatial_upscaling/)