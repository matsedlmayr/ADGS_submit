# Digital Soil Mapping - Waterlogging Analysis

This repository contains the code and data for reproducing the Random Forest analysis of soil waterlogging at 100 cm depth (`waterlog.100`) based on environmental predictors.

---

## Folder structure

- `vignettes/`  
  Contains report (`re1.Rmd`) that demonstrates and interprets the analyses based on the outputs in `analysis/`.

- `analysis/`  
  Contains the main R scripts that perform data preparation, model training, and evaluation:
  - `02_model_training.R` – Trains Random Forest models (basic, Boruta-reduced, tuned, probabilistic) on the soil dataset. 
    Loads data from [GitHub](https://raw.githubusercontent.com/geco-bern/tutorial_digital_soil_mapping/refs/heads/main/data/df_full.rds).  
    *Note:* This could also be replaced by a dataset prepared using `02-data_preparation.R` from the tutorial.  
  - `03_evaluation.R` – Evaluates model performance using confusion matrices, ROC curves, AUC, and probabilistic predictions. Uses the `evaluate_rf_model` function from `R/`.
  - `run_all_digital.R` - Main file to be executed
  
- `R/`  
  Contains helper functions:
  - `evaluate_rf_model.R` – Function to evaluate model performance (confusion matrices, ROC, probabilistic predictions).

- `data/`  
  Stores pre-processed and model-specific datasets and outputs (RDS files).

- `fig/`  
  Contains figures generated by the analysis scripts.

- `book/`, `data-raw/`, `renv/`, `renv.lock`, `LICENSE`, `r_book_template.Rproj`  
  Ignore for reproduction purposes.

---

## How to reproduce
0. If only interested in results step forward to step 4.
1. Open digital_s_mapping/digital_soil_mapping.Rproj to open the project
2. Make sure all required R packages are installed.
3. Run the Main file`run_all_digital.R` in `analysis/` which calls:  
   1. `02_model_training.R` – trains models and saves outputs to `data/`  
   2. `03_evaluation.R` – generates performance metrics and plots and uses the function file `evaluate_rf_model.R` in the folder `R`
4. Use `vignettes/re1.Rmd` to see interpretations, visualizations, and the report write-up.
  *Note:* This is also possible without running the analysis files, as the figures and plots have already been downloaded.

---

## Notes

- All analyses are fully reproducible. Data from `df_full.rds` can be downloaded directly from GitHub.  
- Figures and tables in the vignettes are generated from the outputs of the scripts in `analysis/`.  
- The workflow demonstrates model training, variable selection (Boruta), hyperparameter tuning (caret), and probabilistic prediction for soil waterlogging.